SET search_path = public,tap,contrib,pg_catalog;

BEGIN;
--SELECT plan( 9 );
SELECT * FROM no_plan();

SELECT tables_are( 'public', ARRAY[ 'servers', 'channels', 'nicks' ] );

/****************************************************************************/
-- Validate the servers table.
SELECT has_table(         'servers' );
SELECT has_pk(            'servers' );
SELECT has_column(        'servers', 'name' );
SELECT col_type_is(       'servers', 'name', 'citext' );
SELECT col_not_null(      'servers', 'name' );
SELECT col_hasnt_default( 'servers', 'name' );
SELECT col_is_pk(         'servers', 'name' );

/****************************************************************************/
-- Validate the channels table.
SELECT has_table( 'channels' );
SELECT has_pk(    'channels' );

SELECT has_column(        'channels', 'name' );
SELECT col_type_is(       'channels', 'name', 'citext' );
SELECT col_not_null(      'channels', 'name' );
SELECT col_hasnt_default( 'channels', 'name' );

SELECT has_column(        'channels', 'server' );
SELECT col_type_is(       'channels', 'server', 'citext' );
SELECT col_not_null(      'channels', 'server' );
SELECT col_hasnt_default( 'channels', 'server' );
SELECT col_is_fk(         'channels', 'server' );

SELECT fk_ok(
    'channels', 'server',
    'servers',  'name'
);

SELECT col_is_pk( 'channels', ARRAY['name', 'server'] );

/****************************************************************************/
-- Validate the nicks table.
SELECT has_table( 'nicks' );
SELECT has_pk(    'nicks' );

SELECT has_column(        'nicks', 'name' );
SELECT col_type_is(       'nicks', 'name', 'citext' );
SELECT col_not_null(      'nicks', 'name' );
SELECT col_hasnt_default( 'nicks', 'name' );
SELECT col_is_pk(         'nicks', ARRAY['name', 'server'] );

SELECT has_column(        'nicks', 'server' );
SELECT col_type_is(       'nicks', 'server', 'citext' );
SELECT col_not_null(      'nicks', 'server' );
SELECT col_hasnt_default( 'nicks', 'server' );
SELECT col_is_fk(         'nicks', 'server' );

SELECT fk_ok(
    'nicks',   'server',
    'servers', 'name'
);

SELECT finish();
ROLLBACK;
